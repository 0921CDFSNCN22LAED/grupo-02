<!DOCTYPE html>
<html lang="es">

<head>
    <%- include("./partials/head") %>
</head>

<body>
    <header>
        <%- include("./partials/header") %>
    </header>
    <main class="container-fluid ">
        <%- include("./partials/home-partials/parent-logsecure-modal") %>
        <div class="row max1200px  z-index-1">

            <div class="container ">
                <div class="  col-12 container-fluid">

                    <div class="col-md-8 col-12">
                        <h2>
                            Mi carrito <i class="fas fa-shopping-cart"></i>
                        </h2>
                    </div>

                    <p class=" ">
                        <%= cart.length %> cursos en carrito
                    </p>
                    <section class="d-flex flex-wrap justify-content-center">
                        <% for(let product of cart){ %>
                        <article class="col-12 col-sm-6 col-md-4  my-2">
                            <div class="container m-1 ">
                                <a class=" item descripcionContainer" href="/products/<%= product.classes.id %>">
                                    <div class="
                                                d-flex
                                                flex-column
                                                product-in-products-page
                                            ">
                                        <div class="
                                                    m-1
                                                    product-in-products-page-detail position-relative
                                                    pb-5
                                                ">
                                            <img class="img-thumbnail "
                                                src="/img/clases-preview/<%=product.classes.interactive.preview.location%>"
                                                alt="picture placeholder" />
                                            <div class=" ">
                                                <h5>
                                                    <%= product.classes.title + " en "
                                                            + product.classes.grades.name %>
                                                </h5>
                                                <h5><%=product.classes.subject.name %></h5>
                                                <h5>
                                                    <%=product.classes.teacher.first_name +
                                                            " " +
                                                            product.classes.teacher.last_name %>
                                                </h5>
                                            </div>
                                        </div>
                                        <div class="
                                                    price-and-options
                                                    shadow-pill
                                                    align-self-end
                                                    text-end
                                                    mb-2
                                                ">
                                            <h3>
                                                <%="$" +
                                                    product.classes.price.toFixed(2) %>
                                            </h3>
                                            <div>
                                            </div>
                                            <form action="/sale/removeFromCart/<%=product.classes.id%>?_method=DELETE"
                                                method="post">
                                                <button class="btn btn-danger btn-sm" type="submit">eliminar</button>
                                            </form>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </article>
                        <% } %>

                    </section>

                </div>
                <form class="w-100" action="/sale/payment" method="post">
                    <div class="row ">
                        <div class=" col-md-6 col-12  ">
                            <div class="shadow-pill">
                                <div class="d-flex">
                                    <h5 class="p-1">Asignar curso<%= cart.length > 1 ? "s" : "" %> a:</h5>
                                    <div class="d-inline flex-grow-1">
                                        <select class="form-select " aria-label="select child" name="selectChild"
                                            id="selectChild">
                                            <%if(children.length == 1){ %>
                                            <option value="<%= children[0].id %>" selected><%= children[0].name %>
                                            </option>
                                            <% } else { %>
                                            <option value="" selected>Elegí un hijo</option>
                                            <% for(let child of children) { %>
                                            <option value="<%= child.id %>"
                                                <%= childLogged ? child.id == childLogged.id ? "selected" : "" : ""%>>
                                                <%= child.name %></option>
                                            <% } %>
                                            <% } %>



                                        </select>
                                    </div>
                                </div>
                                <% if(errors && errors.selectChild) { %>
                                <p class="feedback text-start"><%= errors.selectChild.msg %> </p>
                                <% } %>
                            </div>
                        </div>
                        <div class=" col-md-6 col-12">
                            <div class="pay shadow-pill   d-flex justify-content-end">
                                <% if(!parentIsLoggedSecure) { %>
                                <h3>Total: $<%= totalPrice %></h3>
                                <a type="button" data-bs-toggle="modal" data-bs-target="#parentVerificationModal"
                                    class=" btn btn-primary btn-lg">Continuar como padre </a>
                                <% } else if(totalPrice) { %>
                                <h3>Total: $<%= totalPrice %></h3>
                                <button class="btn btn-primary btn-lg" type="submit">Pagar</button>
                                <% } else { %>
                                <a href="/products">
                                    <h3>¡Elegí alguna de nuestras clases en nuestra página
                                        de
                                        clases!</h3>
                                </a>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>




        <section class="row max1200px  z-index-1">
            <div class=" ">
                <h2>También podría gustarte...</h2>
                <section class="d-flex flex-wrap justify-content-start">
                    <% for(let recommendation of recommendations){ %>
                    <article class="col-12 col-sm-6 col-md-4 col-lg-3 my-2">
                        <div class="container m-1 ">
                            <a class=" item" href="/products/<%= recommendation.id %> ">
                                <img class=" img-thumbnail"
                                    src="/img/clases-preview/<%=recommendation.interactive.preview.location %> "
                                    alt="<%= recommendation.title %> " />
                                <h4>
                                    <%= recommendation.title %>
                                </h4>
                            </a>
                        </div>
                    </article>
                    <% } %>
                </section>
            </div>
        </section>

    </main>
    <%- include("./partials/footer") %>
</body>

</html>